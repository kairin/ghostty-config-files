# CLI Interface Contract: start.sh
# Date: 2025-11-18
# Description: Command-line interface specification for the main installation orchestrator

name: start.sh
description: Main installation orchestrator for Ghostty Configuration Files
version: "2.0"
type: shell_script
language: bash

command_line:
  usage: "./start.sh [OPTIONS]"
  
  options:
    - name: --help
      short: -h
      description: Show usage information and available options
      type: flag
      required: false
      
    - name: --verbose
      short: -v
      description: Show expanded output (no collapsing tasks to single lines)
      type: flag
      required: false
      default: false
      
    - name: --resume
      short: -r
      description: Resume interrupted installation from last checkpoint
      type: flag
      required: false
      notes: Reads /tmp/ghostty-start-logs/installation-state.json
      
    - name: --force-all
      short: -f
      description: Reinstall all components (ignore idempotency checks)
      type: flag
      required: false
      warning: User customizations will be backed up but reinstallation forced
      
    - name: --skip-checks
      description: Skip pre-installation health checks (not recommended)
      type: flag
      required: false
      warning: May result in installation failures if prerequisites missing
      
    - name: --box-style
      short: -b
      description: Force specific box drawing style
      type: option
      required: false
      values:
        - ascii      # Maximum compatibility (+---+)
        - utf8       # UTF-8 light-line (┌───┐)
        - utf8-double # UTF-8 double-line (╔═══╗)
      default: auto  # Automatic detection based on terminal
      
  examples:
    - command: "./start.sh"
      description: Standard installation with auto-detected box drawing
      
    - command: "./start.sh --verbose"
      description: Installation with full output (no task collapsing)
      
    - command: "./start.sh --resume"
      description: Resume interrupted installation from checkpoint
      
    - command: "./start.sh --box-style ascii"
      description: Force ASCII boxes for SSH or legacy terminals
      
    - command: "./start.sh --verbose --box-style ascii"
      description: Combination for SSH debugging with full output
      
    - command: "./start.sh --force-all"
      description: Reinstall all components (update scenario)

exit_codes:
  0: Success - all tasks completed and verified
  1: Failure - one or more tasks failed
  2: User aborted - CTRL+C or manual exit
  3: Prerequisites missing - health check failed

environment_variables:
  - name: BOX_DRAWING
    description: Override box drawing style (ascii|utf8|utf8-double)
    required: false
    example: "export BOX_DRAWING=ascii && ./start.sh"
    
  - name: LOG_LEVEL
    description: Set logging verbosity (DEBUG|INFO|WARNING|ERROR)
    required: false
    default: INFO
    
  - name: GHOSTTY_APP_DIR
    description: Override Ghostty installation directory
    required: false
    default: "$HOME/Apps/ghostty"

output:
  stdout:
    - Docker-like collapsible task output
    - Progress bars and spinners (via gum)
    - Status indicators (✓ ✗ ⠋ ⏸)
    - Summary report at end
    
  stderr:
    - Error messages with recovery suggestions
    - Warning messages (non-blocking issues)
    
  files:
    - path: /tmp/ghostty-start-logs/start-TIMESTAMP.log
      description: Human-readable installation log
      format: text
      
    - path: /tmp/ghostty-start-logs/start-TIMESTAMP.log.json
      description: Structured JSON log for parsing
      format: json
      
    - path: /tmp/ghostty-start-logs/errors.log
      description: Critical errors only (append-only)
      format: text
      
    - path: /tmp/ghostty-start-logs/installation-state.json
      description: Resume state (completed/failed tasks)
      format: json

behavior:
  idempotency: true
  resume_capability: true
  parallel_execution: true
  graceful_degradation: true
  user_customization_preservation: true

requirements:
  - Bash 5.x+ required
  - sudo access recommended (passwordless preferred)
  - Internet connectivity required
  - 10GB+ free disk space required
  - Ubuntu 25.10+ target platform

performance_targets:
  total_installation: 10 minutes maximum
  idempotent_rerun: 30 seconds maximum
  fnm_startup: 50ms maximum (constitutional)
  gum_startup: 10ms maximum

dependencies:
  external:
    - gum (Charm Bracelet) - installed as prerequisite
    - curl/wget - for downloading packages
    - git - for cloning repositories
    - jq - for JSON processing
    - bc - for duration calculations
    
  internal:
    - lib/core/*.sh - Core functionality modules
    - lib/ui/*.sh - TUI component modules
    - lib/tasks/*.sh - Installation task modules
    - lib/verification/*.sh - Verification test modules
