<!DOCTYPE html><html lang="en" data-theme="light" class="transition-colors duration-200"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/ghostty-config-files/favicon.svg"><meta name="generator" content="Astro v5.15.9"><title>Feature Specification: Modern TUI Installation System | Ghostty Configuration Files</title><meta name="description" content="**Feature Branch**: `001-modern-tui-system`"><!-- OpenGraph --><meta property="og:title" content="Feature Specification: Modern TUI Installation System"><meta property="og:description" content="**Feature Branch**: `001-modern-tui-system`"><meta property="og:type" content="website"><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/ghostty-config-files/_astro/_slug_.ZRO-SjbT.css"></head> <body class="min-h-screen bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100 transition-colors duration-200 cyber-bg"> <!-- Modern Glass Morphism Navigation --> <nav class="fixed top-0 w-full backdrop-blur-xl bg-white/80 dark:bg-slate-900/80 shadow-lg border-b border-gray-200/50 dark:border-gray-700/50 z-50 transition-all duration-300"> <div class="full-width-section"> <div class="navbar"> <div class="flex-1"> <a href="/ghostty-config-files/" class="btn btn-ghost text-xl font-bold hover:text-blue-600 dark:hover:text-cyan-400 transition-all"> <span class="hidden md:inline">Ghostty Config Files</span> <span class="md:hidden">Ghostty</span> </a> </div> <div class="flex-none gap-2"> <ul class="menu menu-horizontal px-1 hidden lg:flex gap-4"> <li><a href="/ghostty-config-files/user-guide" class="nav-link">User Guide</a></li> <li><a href="/ghostty-config-files/ai-guidelines" class="nav-link">AI Guidelines</a></li> <li><a href="/ghostty-config-files/developer" class="nav-link">Developer</a></li> <li> <a href="https://github.com/kairin/ghostty-config-files" target="_blank" rel="noopener noreferrer" class="nav-link">
GitHub
</a> </li> </ul> <button id="theme-toggle" class="btn btn-ghost btn-circle" aria-label="Toggle theme" title="Toggle dark/light mode" data-astro-cid-x3pjskd3> <svg id="theme-icon-sun" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-x3pjskd3> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" data-astro-cid-x3pjskd3></path> </svg> <svg id="theme-icon-moon" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-x3pjskd3> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" data-astro-cid-x3pjskd3></path> </svg> </button> <script type="module">function c(){const e=document.documentElement,t=document.getElementById("theme-icon-sun"),n=document.getElementById("theme-icon-moon"),d=localStorage.getItem("theme"),s=window.matchMedia("(prefers-color-scheme: dark)").matches,o=d||(s?"dark":"light");o==="dark"?(e.setAttribute("data-theme","dark"),e.classList.add("dark"),t&&t.classList.remove("hidden"),n&&n.classList.add("hidden")):(e.setAttribute("data-theme","light"),e.classList.remove("dark"),t&&t.classList.add("hidden"),n&&n.classList.remove("hidden")),localStorage.setItem("theme",o)}function a(){const e=document.documentElement,t=document.getElementById("theme-icon-sun"),n=document.getElementById("theme-icon-moon"),s=e.getAttribute("data-theme")==="dark"?"light":"dark";e.setAttribute("data-theme",s),s==="dark"?(e.classList.add("dark"),t&&t.classList.remove("hidden"),n&&n.classList.add("hidden")):(e.classList.remove("dark"),t&&t.classList.add("hidden"),n&&n.classList.remove("hidden")),localStorage.setItem("theme",s)}c();const m=document.getElementById("theme-toggle");m&&m.addEventListener("click",a);document.addEventListener("astro:page-load",c);</script>  </div> </div> </div> </nav> <!-- Spacer for fixed nav --> <div class="h-20"></div> <!-- Main Content - Full Width --> <main class="w-full px-4 md:px-8 lg:px-12 xl:px-16 py-12"> <!-- Article Header (if metadata provided) --> <div class="mb-8 text-sm text-gray-600 dark:text-gray-400"> <time datetime="2025-11-25T00:00:00.000Z"> November 25, 2025 </time> <span> by Ghostty Config Team</span> </div> <!-- Page Content - Full Width with Max Readable for Prose --> <article class="prose prose-lg w-full max-w-none text-lg leading-relaxed">  <div class="breadcrumbs text-sm mb-6"> <ul> <li><a href="/ghostty-config-files/">Home</a></li> <li><a href="/ghostty-config-files/developer/architecture">Developer</a></li> <li>Feature Specification: Modern TUI Installation System</li> </ul> </div> <h1>Feature Specification: Modern TUI Installation System</h1> <p class="text-xl text-base-content/70 mb-8">**Feature Branch**: `001-modern-tui-system`</p><h1 id="feature-specification-modern-tui-installation-system">Feature Specification: Modern TUI Installation System</h1>
<p><strong>Feature Branch</strong>: <code>001-modern-tui-system</code>
<strong>Created</strong>: 2025-11-18
<strong>Status</strong>: Draft
<strong>Input</strong>: User description: “Implement robust TUI system with gum framework, adaptive box drawing, real verification tests, collapsible output, uv/fnm package management, and app duplicate detection/cleanup”</p>
<h2 id="user-scenarios--testing-mandatory">User Scenarios &#x26; Testing <em>(mandatory)</em></h2>
<h3 id="user-story-1---fresh-installation-experience-priority-p1">User Story 1 - Fresh Installation Experience (Priority: P1)</h3>
<p>A user runs <code>./start.sh</code> on a fresh Ubuntu system and sees a beautiful, professional installation process with proper box drawing, real-time progress, and collapsible output like Docker. Professional appearance measured by SC-002: Zero broken box characters across all terminal types.</p>
<p><strong>Why this priority</strong>: This is the primary user journey and the most common use case. Without a working installation system, nothing else matters. This delivers immediate value by providing a functional terminal environment.</p>
<p><strong>Independent Test</strong>: Can be fully tested by running <code>./start.sh</code> on a clean Ubuntu VM and verifying: (1) no broken box characters appear, (2) all components install successfully, (3) verification tests pass with real system checks, (4) output collapses completed tasks to single lines. Delivers a working Ghostty terminal environment.</p>
<p><strong>Acceptance Scenarios</strong>:</p>
<ol>
<li><strong>Given</strong> fresh Ubuntu 25.10 system, <strong>When</strong> user runs <code>./start.sh</code>, <strong>Then</strong> sees UTF-8 box drawing (╔═╗) if terminal supports it, or ASCII boxes (+=-|) if SSH/legacy terminal</li>
<li><strong>Given</strong> installation running, <strong>When</strong> task completes, <strong>Then</strong> output collapses to single line: <code>✓ Task name (duration)</code> with green checkmark</li>
<li><strong>Given</strong> all tasks complete, <strong>When</strong> user checks system, <strong>Then</strong> all components verified with real tests (not hard-coded success messages)</li>
<li><strong>Given</strong> installation process, <strong>When</strong> error occurs, <strong>Then</strong> error auto-expands with recovery suggestions and continue-or-abort option</li>
</ol>
<hr>
<h3 id="user-story-2---ssh-installation-support-priority-p1">User Story 2 - SSH Installation Support (Priority: P1)</h3>
<p>A user connects via SSH and runs installation, receiving readable ASCII box drawing instead of broken UTF-8 characters.</p>
<p><strong>Why this priority</strong>: SSH installations are extremely common for server setups and remote development. Broken characters make the installation appear unprofessional and difficult to follow. This ensures installation works universally.</p>
<p><strong>Independent Test</strong>: Can be tested by SSHing into a remote system and running <code>./start.sh</code>. Verify ASCII boxes (+=-|) appear instead of broken UTF-8, all progress indicators work, verification tests pass. Delivers remote installation capability.</p>
<p><strong>Acceptance Scenarios</strong>:</p>
<ol>
<li><strong>Given</strong> SSH connection to remote system, <strong>When</strong> user runs <code>./start.sh</code>, <strong>Then</strong> system detects SSH_CONNECTION and uses ASCII box drawing automatically</li>
<li><strong>Given</strong> legacy terminal (TERM=linux), <strong>When</strong> installation runs, <strong>Then</strong> uses ASCII fallback for all UI elements</li>
<li><strong>Given</strong> manual override via <code>BOX_DRAWING=utf8</code>, <strong>When</strong> installation runs, <strong>Then</strong> forces UTF-8 boxes even on SSH (for advanced users with capable terminals)</li>
</ol>
<hr>
<h3 id="user-story-3---re-run-and-resume-safety-priority-p1">User Story 3 - Re-run and Resume Safety (Priority: P1)</h3>
<p>A user’s installation fails halfway through, or they want to update their system. Running <code>./start.sh</code> again safely skips completed tasks, preserves customizations, and resumes from where it stopped.</p>
<p><strong>Why this priority</strong>: Idempotency is critical for reliability and user confidence. Users should never fear re-running installation for updates or recovery. This prevents configuration corruption and data loss.</p>
<p><strong>Independent Test</strong>: Run <code>./start.sh</code> twice in succession. First run completes fully. Second run detects existing installations via real verification functions, skips completed tasks (shows <code>↷ Already installed</code>), completes in &#x3C;30 seconds. User customizations remain intact.</p>
<p><strong>Acceptance Scenarios</strong>:</p>
<ol>
<li><strong>Given</strong> Ghostty already installed, <strong>When</strong> user runs <code>./start.sh</code> again, <strong>Then</strong> verification function detects existing installation and skips task</li>
<li><strong>Given</strong> user has custom ZSH configuration, <strong>When</strong> installation updates ZSH, <strong>Then</strong> preserves user customizations and only updates framework components</li>
<li><strong>Given</strong> installation interrupted at task 5 of 10, <strong>When</strong> user re-runs <code>./start.sh</code>, <strong>Then</strong> state persistence allows resuming from task 5</li>
</ol>
<hr>
<h3 id="user-story-4---duplicate-app-detection-and-cleanup-priority-p2">User Story 4 - Duplicate App Detection and Cleanup (Priority: P2)</h3>
<p>A user wants to clean up their Ubuntu system which has accumulated duplicate applications (snap vs apt versions, disabled snaps, multiple browsers). The system detects duplicates and recommends cleanup.</p>
<p><strong>Why this priority</strong>: Addresses real problem from app audit (4GB+ waste from duplicates). Important for system maintenance but not critical for initial installation. Delivers immediate disk space savings and cleaner app drawer.</p>
<p><strong>Independent Test</strong>: Run app audit command, receive report of duplicates (e.g., “Firefox: snap enabled + apt removed candidate, VLC: snap + apt both active”). Follow cleanup recommendations, verify duplicates removed, app drawer shows single icons, disk space recovered. Can be tested independently of installation system.</p>
<p><strong>Acceptance Scenarios</strong>:</p>
<ol>
<li><strong>Given</strong> system with duplicate apps, <strong>When</strong> user runs app audit, <strong>Then</strong> receives categorized report of duplicates with disk usage and recommendations</li>
<li><strong>Given</strong> audit identifies snap+apt duplicates, <strong>When</strong> user approves cleanup, <strong>Then</strong> system safely removes duplicates while preserving user data and preferences</li>
<li><strong>Given</strong> 10 disabled snap versions, <strong>When</strong> cleanup executes, <strong>Then</strong> removes disabled snaps and recovers 2GB+ disk space</li>
<li><strong>Given</strong> 4 browsers installed, <strong>When</strong> user selects preferred browser, <strong>Then</strong> system offers to remove others while preserving bookmarks/settings</li>
</ol>
<hr>
<h3 id="user-story-5---best-practice-app-installation-priority-p2">User Story 5 - Best Practice App Installation (Priority: P2)</h3>
<p>All applications are installed following best practices from Context7 MCP, ensuring optimal installation method (snap vs apt), proper configuration, and security compliance.</p>
<p><strong>Why this priority</strong>: Ensures long-term system health and consistency. Not blocking for basic functionality but critical for professional deployments. Prevents future issues from improper installations.</p>
<p><strong>Independent Test</strong>: Query Context7 for recommended installation methods for common apps (Ghostty, Chrome, VS Code). Compare current installations against recommendations. Generate compliance report. Can be tested independently by running Context7 queries.</p>
<p><strong>Acceptance Scenarios</strong>:</p>
<ol>
<li><strong>Given</strong> app to install, <strong>When</strong> installation checks Context7, <strong>Then</strong> uses recommended method (snap/apt/source) and configuration</li>
<li><strong>Given</strong> existing non-compliant installation, <strong>When</strong> audit runs, <strong>Then</strong> flags non-compliance and suggests migration path</li>
<li><strong>Given</strong> security-sensitive app, <strong>When</strong> installing, <strong>Then</strong> follows Context7 security hardening recommendations</li>
</ol>
<hr>
<h3 id="user-story-6---verbose-mode-toggle-priority-p3">User Story 6 - Verbose Mode Toggle (Priority: P3)</h3>
<p>A user debugging an installation issue can press ‘v’ or use <code>--verbose</code> flag to expand all collapsed output and see full logs in real-time.</p>
<p><strong>Why this priority</strong>: Nice-to-have for debugging but not essential for basic functionality. Users can always check logs in <code>/tmp/ghostty-start-logs/</code>. Enhances troubleshooting experience.</p>
<p><strong>Independent Test</strong>: Run <code>./start.sh</code>, wait for tasks to collapse, press ‘v’ key. Verify all collapsed tasks expand to show full output. Run <code>./start.sh --verbose</code> and verify no tasks collapse. Delivers debugging capability.</p>
<p><strong>Acceptance Scenarios</strong>:</p>
<ol>
<li><strong>Given</strong> installation running with collapsed output, <strong>When</strong> user presses ‘v’, <strong>Then</strong> all collapsed tasks expand to show full output</li>
<li><strong>Given</strong> <code>./start.sh --verbose</code> executed, <strong>When</strong> tasks complete, <strong>Then</strong> output remains expanded (no collapsing)</li>
<li><strong>Given</strong> verbose mode active, <strong>When</strong> user presses ‘v’ again, <strong>Then</strong> toggles back to collapsed mode</li>
</ol>
<hr>
<h3 id="user-story-7---parallel-task-execution-priority-p3">User Story 7 - Parallel Task Execution (Priority: P3)</h3>
<p>Independent tasks (e.g., installing Ghostty while setting up ZSH) execute in parallel with visual progress for each, completing installation faster.</p>
<p><strong>Why this priority</strong>: Performance optimization that improves user experience but not critical for MVP. Sequential execution is acceptable for initial version. Delivers faster installation times.</p>
<p><strong>Independent Test</strong>: Run installation with parallel execution enabled. Verify multiple spinners shown simultaneously for independent tasks. Compare total time against sequential baseline (should be 30-40% faster). Can be tested by comparing parallel vs sequential execution.</p>
<p><strong>Acceptance Scenarios</strong>:</p>
<ol>
<li><strong>Given</strong> 5 independent tasks detected, <strong>When</strong> installation runs, <strong>Then</strong> up to 3 tasks execute in parallel with separate progress indicators</li>
<li><strong>Given</strong> task dependency detected, <strong>When</strong> parallel execution runs, <strong>Then</strong> dependent tasks wait for prerequisites to complete</li>
<li><strong>Given</strong> parallel execution, <strong>When</strong> one task fails, <strong>Then</strong> other tasks continue and aggregate errors at end</li>
</ol>
<hr>
<h3 id="edge-cases">Edge Cases</h3>
<ul>
<li><strong>What happens when gum is not installed?</strong> System gracefully degrades to plain text output with basic formatting (colors, checkmarks) and installs gum as first task for improved UX on subsequent runs.</li>
<li><strong>What happens when terminal doesn’t support UTF-8?</strong> Automatic detection via TERM environment variable and SSH_CONNECTION triggers ASCII fallback. Manual override via <code>BOX_DRAWING=ascii</code> environment variable.</li>
<li><strong>How does system handle network failures during package installation?</strong> Error handler detects network errors, provides recovery suggestions (check connection, retry, skip), allows user to continue or abort. Failed tasks logged for retry on next run.</li>
<li><strong>What happens when verification function fails but installation appeared successful?</strong> Error expands with full diagnostic output, suggested fixes, and option to skip verification (not recommended). Logs capture full context for troubleshooting.</li>
<li><strong>How does system handle conflicting package versions?</strong> Detects conflicts during pre-installation phase, reports to user with recommendations, offers to resolve automatically or abort.</li>
<li><strong>What happens when disk space is insufficient?</strong> Pre-flight check calculates required space, compares against available, warns user if insufficient, suggests cleanup options (including app duplicate removal).</li>
<li><strong>How does system handle interrupted installations (killed process, power loss)?</strong> State persistence in JSON files allows resume from last checkpoint. Incomplete tasks re-verified on next run.</li>
<li><strong>What happens when user has non-standard shell (fish, tcsh)?</strong> Detection of current shell, warnings about limited support, offers to install ZSH, preserves existing shell configuration.</li>
</ul>
<h2 id="requirements-mandatory">Requirements <em>(mandatory)</em></h2>
<h3 id="functional-requirements">Functional Requirements</h3>
<h4 id="tui-framework--box-drawing">TUI Framework &#x26; Box Drawing</h4>
<ul>
<li><strong>FR-001</strong>: System MUST use gum (Charm Bracelet) exclusively for all TUI elements (spinners, progress bars, prompts, styled output)</li>
<li><strong>FR-002</strong>: System MUST detect terminal capability via TERM environment variable and SSH_CONNECTION to choose UTF-8 or ASCII box drawing</li>
<li><strong>FR-003</strong>: System MUST render UTF-8 double-line boxes (╔═╗ ║ ╚═╝) for modern terminals (Ghostty, xterm, alacritty, kitty, tmux, screen)</li>
<li><strong>FR-004</strong>: System MUST render ASCII boxes (+=-|) for SSH connections and legacy terminals</li>
<li><strong>FR-005</strong>: System MUST support manual override via BOX_DRAWING environment variable (utf8/ascii)</li>
<li><strong>FR-006</strong>: System MUST gracefully degrade to plain text if gum unavailable, with installation of gum as first priority task</li>
</ul>
<h4 id="verification--testing">Verification &#x26; Testing</h4>
<ul>
<li><strong>FR-007</strong>: System MUST implement real verification functions that check actual system state (NOT hard-coded success messages)</li>
<li><strong>FR-008</strong>: Every installation task MUST have corresponding <code>verify_&#x3C;component>()</code> function</li>
<li><strong>FR-009</strong>: Verification functions MUST check command existence via <code>command -v</code>, version numbers, file contents, and service status</li>
<li><strong>FR-010</strong>: Verification functions MUST return proper exit codes (0=success, 1=failure) for automated testing</li>
<li><strong>FR-011</strong>: System MUST implement multi-layer verification: unit tests (per-component), integration tests (cross-component), health checks (pre/post)</li>
<li><strong>FR-012</strong>: System MUST capture verification results in structured JSON logs with timestamps, exit codes, and diagnostic output</li>
</ul>
<h4 id="progressive-summarization--output-management">Progressive Summarization &#x26; Output Management</h4>
<ul>
<li><strong>FR-013</strong>: System MUST collapse completed tasks to single-line summaries: <code>✓ Task name (duration)</code></li>
<li><strong>FR-014</strong>: System MUST show active task with full output and animated spinner via gum</li>
<li><strong>FR-015</strong>: System MUST show queued tasks with pending status indicator (⏸)</li>
<li><strong>FR-016</strong>: System MUST auto-expand errors with recovery suggestions and continue-or-abort prompt</li>
<li><strong>FR-017</strong>: System MUST support verbose mode toggle (press ‘v’ or —verbose flag) to expand/collapse all output</li>
<li><strong>FR-018</strong>: System MUST display overall progress percentage and time estimates</li>
<li><strong>FR-019</strong>: System MUST use color-coded output (green=success, yellow=warning, red=error, blue=info)</li>
</ul>
<h4 id="modular-architecture">Modular Architecture</h4>
<ul>
<li><strong>FR-020</strong>: System MUST organize code in modular lib/ structure with lib/core/, lib/ui/, lib/tasks/, lib/verification/</li>
<li><strong>FR-021</strong>: System MUST implement lib/core/logging.sh for structured logging (JSON + human-readable)</li>
<li><strong>FR-022</strong>: System MUST implement lib/core/state.sh for state management and resume capability</li>
<li><strong>FR-023</strong>: System MUST implement lib/core/errors.sh for error handling with recovery suggestions</li>
<li><strong>FR-024</strong>: System MUST implement lib/ui/tui.sh for gum integration and TUI components</li>
<li><strong>FR-025</strong>: System MUST implement lib/ui/boxes.sh for adaptive box drawing functions</li>
<li><strong>FR-026</strong>: System MUST implement lib/ui/collapsible.sh for progressive summarization</li>
<li><strong>FR-027</strong>: System MUST implement lib/ui/progress.sh for progress bars and spinners</li>
<li><strong>FR-028</strong>: System MUST implement lib/tasks/*.sh for each installation component (ghostty.sh, zsh.sh, python_uv.sh, nodejs_fnm.sh, ai_tools.sh)</li>
<li><strong>FR-029</strong>: System MUST implement lib/verification/unit_tests.sh for per-component verification</li>
<li><strong>FR-030</strong>: System MUST implement lib/verification/integration_tests.sh for cross-component validation</li>
<li><strong>FR-031</strong>: System MUST implement lib/verification/health_checks.sh for pre/post installation checks</li>
</ul>
<h4 id="package-management">Package Management</h4>
<ul>
<li><strong>FR-032</strong>: System MUST use uv exclusively for ALL Python package operations (uv pip install, uv run, uv venv)</li>
<li><strong>FR-033</strong>: System MUST prohibit usage of pip, pip3, python -m pip, poetry, pipenv for Python packages</li>
<li><strong>FR-034</strong>: System MUST use fnm exclusively for ALL Node.js version management (fnm install, fnm use, fnm default)</li>
<li><strong>FR-035</strong>: System MUST prohibit usage of nvm, n, asdf, manual Node.js installation</li>
<li><strong>FR-036</strong>: System MUST verify uv installation with real version check: <code>uv --version</code> returns valid version</li>
<li><strong>FR-037</strong>: System MUST verify fnm installation with real startup time check: performance measured and logged (constitutional requirement)</li>
<li><strong>FR-038</strong>: System MUST install latest Node.js version (v25.2.0+) via fnm for AI tools and Astro documentation site</li>
</ul>
<h4 id="structured-logging">Structured Logging</h4>
<ul>
<li><strong>FR-039</strong>: System MUST implement dual-format logging: human-readable console output + structured JSON logs</li>
<li><strong>FR-040</strong>: System MUST write human-readable logs to /tmp/ghostty-start-logs/start-TIMESTAMP.log</li>
<li><strong>FR-041</strong>: System MUST write structured JSON logs to /tmp/ghostty-start-logs/start-TIMESTAMP.log.json</li>
<li><strong>FR-042</strong>: System MUST write critical errors to /tmp/ghostty-start-logs/errors.log</li>
<li><strong>FR-043</strong>: System MUST capture performance metrics in /tmp/ghostty-start-logs/performance.json</li>
<li><strong>FR-044</strong>: System MUST capture system state snapshots in /tmp/ghostty-start-logs/system_state_TIMESTAMP.json</li>
<li><strong>FR-045</strong>: System MUST implement log rotation keeping last 10 installations</li>
<li><strong>FR-046</strong>: System MUST log task timing (start time, end time, duration) for performance analysis</li>
</ul>
<h4 id="error-handling--recovery">Error Handling &#x26; Recovery</h4>
<ul>
<li><strong>FR-047</strong>: Error messages MUST include: what failed, why it likely failed, how to fix it</li>
<li><strong>FR-048</strong>: Errors MUST auto-expand in collapsible output with full diagnostic information</li>
<li><strong>FR-049</strong>: System MUST provide continue-or-abort option for non-critical errors</li>
<li><strong>FR-050</strong>: System MUST implement rollback capability for failed tasks where applicable</li>
<li><strong>FR-051</strong>: System MUST aggregate all errors at end of installation with summary report</li>
<li><strong>FR-052</strong>: System MUST provide recovery suggestions specific to error type (network, permissions, dependencies, conflicts)</li>
</ul>
<h4 id="idempotency--resume-capability">Idempotency &#x26; Resume Capability</h4>
<ul>
<li><strong>FR-053</strong>: System MUST check existing state before installation and skip if already installed</li>
<li><strong>FR-054</strong>: System MUST preserve user customizations during updates (e.g., .zshrc, .bashrc, ~/.config/ghostty/config, shell aliases, environment variables)</li>
<li><strong>FR-055</strong>: System MUST backup critical files before modification with timestamped backups</li>
<li><strong>FR-056</strong>: System MUST implement restore capability for failed modifications</li>
<li><strong>FR-057</strong>: System MUST persist installation state in JSON files for resume capability after interruption</li>
<li><strong>FR-058</strong>: System MUST detect interrupted installations and resume from last checkpoint</li>
</ul>
<h4 id="performance-standards">Performance Standards</h4>
<ul>
<li><strong>FR-059</strong>: System MUST complete total installation in &#x3C;10 minutes on fresh Ubuntu system</li>
<li><strong>FR-060</strong>: System MUST validate fnm startup time performance measured and logged (constitutional requirement)</li>
<li><strong>FR-061</strong>: System MUST validate gum startup time performance measured and logged (verified during installation)</li>
<li><strong>FR-062</strong>: System MUST execute independent tasks in parallel where dependencies allow (maximum 3 concurrent tasks for system stability and resource management)</li>
<li><strong>FR-063</strong>: System MUST update progress feedback at least every 5 seconds during long-running tasks</li>
</ul>
<h4 id="app-duplicate-detection--cleanup">App Duplicate Detection &#x26; Cleanup</h4>
<ul>
<li><strong>FR-064</strong>: System MUST scan for duplicate applications (snap vs apt, disabled snaps, multiple browsers)</li>
<li><strong>FR-065</strong>: System MUST categorize duplicates by type: enabled duplicates, disabled snaps, unnecessary browsers</li>
<li><strong>FR-066</strong>: System MUST calculate disk usage for each duplicate category</li>
<li><strong>FR-067</strong>: System MUST generate audit report with recommendations in /tmp/ubuntu-apps-audit.md</li>
<li><strong>FR-068</strong>: System MUST provide safe cleanup commands that preserve user data and preferences</li>
<li><strong>FR-069</strong>: System MUST verify app icon clarity in Ubuntu “Show Apps” after cleanup (no duplicate icons)</li>
<li><strong>FR-070</strong>: System MUST support selective cleanup (user chooses which duplicates to remove)</li>
</ul>
<h4 id="context7-integration-for-best-practices">Context7 Integration for Best Practices</h4>
<ul>
<li><strong>FR-071</strong>: System MUST query Context7 MCP for recommended installation methods before installing apps</li>
<li><strong>FR-072</strong>: System MUST follow Context7 recommendations for snap vs apt vs source installation</li>
<li><strong>FR-073</strong>: System MUST validate existing installations against Context7 best practices</li>
<li><strong>FR-074</strong>: System MUST generate compliance report flagging non-compliant installations</li>
<li><strong>FR-075</strong>: System MUST suggest migration paths for non-compliant installations</li>
</ul>
<h3 id="key-entities-include-if-feature-involves-data">Key Entities <em>(include if feature involves data)</em></h3>
<ul>
<li>
<p><strong>Installation Task</strong>: Represents a single installation step (name, description, verify_function, dependencies, estimated_duration, status [pending/in_progress/completed/failed], actual_duration, error_message). Tasks are organized in lib/tasks/ with separate files per component.</p>
</li>
<li>
<p><strong>System State Snapshot</strong>: Captures complete system state at specific points (timestamp, hostname, kernel_version, os_version, installed_packages, disk_usage, memory_usage, active_services). Used for before/after comparison and debugging. Stored as JSON in /tmp/ghostty-start-logs/system_state_TIMESTAMP.json.</p>
</li>
<li>
<p><strong>Verification Result</strong>: Outcome of verification function execution (task_name, verify_function, exit_code, stdout, stderr, duration, timestamp, success_boolean). Stored in structured logs for analysis and debugging.</p>
</li>
<li>
<p><strong>App Installation Record</strong>: Details of installed application (app_name, installation_method [snap/apt/source], version, disk_usage, install_date, icon_path, compliance_status). Used for duplicate detection and Context7 validation.</p>
</li>
<li>
<p><strong>Cleanup Plan</strong>: Generated recommendations for duplicate removal (duplicate_type, apps_affected, disk_space_recoverable, user_data_locations, cleanup_commands, risk_level [low/medium/high], user_approval_required). User reviews and approves before execution.</p>
</li>
<li>
<p><strong>Performance Metrics</strong>: Task-level timing and system resource usage (task_name, start_time, end_time, duration, cpu_usage, memory_usage, disk_io). Aggregated for performance dashboard and optimization analysis.</p>
</li>
</ul>
<h2 id="success-criteria-mandatory">Success Criteria <em>(mandatory)</em></h2>
<h3 id="measurable-outcomes">Measurable Outcomes</h3>
<ul>
<li><strong>SC-001</strong>: Installation completes in &#x3C;10 minutes on fresh Ubuntu 25.10 system (constitutional performance requirement)</li>
<li><strong>SC-002</strong>: Zero broken box characters across all supported terminals (Ghostty, xterm, SSH, legacy) verified by visual testing</li>
<li><strong>SC-003</strong>: 100% of installation tasks have real verification functions (no hard-coded success messages) verified by code inspection</li>
<li><strong>SC-004</strong>: Verification accuracy ≥99% (verification passes IFF component actually installed) measured by integration tests</li>
<li><strong>SC-005</strong>: Re-running installation completes in &#x3C;30 seconds with all tasks correctly skipped (idempotency) verified by automated testing</li>
<li><strong>SC-006</strong>: Error recovery suggestions provided for 100% of errors with actionable next steps verified by error injection testing</li>
<li><strong>SC-007</strong>: App duplicate cleanup recovers ≥4GB disk space on typical system (based on audit findings) verified by before/after measurement</li>
<li><strong>SC-008</strong>: App icon clarity: Zero duplicate icons in Ubuntu “Show Apps” after cleanup verified by manual inspection</li>
<li><strong>SC-009</strong>: Installation success rate ≥99% across different Ubuntu configurations (fresh install, existing system, SSH, VM) measured by CI/CD testing</li>
<li><strong>SC-010</strong>: Parallel execution reduces installation time by 30-40% compared to sequential baseline measured by performance benchmarks</li>
<li><strong>SC-011</strong>: User satisfaction: 90% of users rate installation experience as “professional” and “easy to follow” measured by user surveys (future)</li>
<li><strong>SC-012</strong>: fnm startup time performance measured and logged (constitutional requirement) verified during installation and in performance tests</li>
<li><strong>SC-013</strong>: gum startup time performance measured and logged verified during installation</li>
<li><strong>SC-014</strong>: All Context7 recommendations followed for app installations (100% compliance) verified by audit</li>
<li><strong>SC-015</strong>: User customizations preserved: 100% retention of ZSH configs, Ghostty themes, shell aliases during updates verified by diff testing</li>
</ul>
<h2 id="scope">Scope</h2>
<h3 id="in-scope">In Scope</h3>
<ul>
<li>Complete TUI system redesign using gum framework</li>
<li>Adaptive UTF-8/ASCII box drawing with automatic detection</li>
<li>Real verification functions for all installation components</li>
<li>Progressive summarization (Docker-like collapsible output)</li>
<li>Modular lib/ architecture (core, ui, tasks, verification)</li>
<li>Exclusive uv for Python package management</li>
<li>Exclusive fnm for Node.js version management</li>
<li>Structured dual-format logging (JSON + human-readable)</li>
<li>Error handling with recovery suggestions</li>
<li>Idempotency and resume capability</li>
<li>Performance optimization with parallel execution</li>
<li>App duplicate detection and cleanup</li>
<li>Context7 integration for best practices</li>
<li>Constitutional compliance enforcement</li>
</ul>
<h3 id="out-of-scope-future-enhancements">Out of Scope (Future Enhancements)</h3>
<ul>
<li>GUI installation interface (TUI only in this spec)</li>
<li>Remote installation orchestration (single system only)</li>
<li>Installation via containers/Docker (bare metal Ubuntu only)</li>
<li>Windows/macOS support (Ubuntu 25.10 only)</li>
<li>Automated scheduled installations (manual execution only)</li>
<li>Installation analytics dashboard (logging only)</li>
<li>Multi-language support (English only)</li>
<li>Installation via configuration management tools (Ansible, Chef, Puppet)</li>
</ul>
<h2 id="assumptions">Assumptions</h2>
<ol>
<li><strong>Target System</strong>: Ubuntu 25.10 (Questing) fresh installation or existing system</li>
<li><strong>Internet Access</strong>: Stable internet connection required for package downloads</li>
<li><strong>User Permissions</strong>: User has sudo access (passwordless sudo recommended)</li>
<li><strong>Disk Space</strong>: Minimum 10GB free space available</li>
<li><strong>Terminal Support</strong>: Modern terminal emulator (Ghostty, xterm, or better) or SSH client</li>
<li><strong>Shell</strong>: Bash 5.x+ available (for installation script execution)</li>
<li><strong>Package Managers</strong>: apt/dpkg and snap available on system</li>
<li><strong>UTF-8 Locale</strong>: System configured with UTF-8 locale (standard on Ubuntu 25.10)</li>
<li><strong>GitHub CLI</strong>: Available for MCP integration (installed if missing)</li>
<li><strong>Context7 API Key</strong>: Available in .env for best practices queries (optional but recommended)</li>
</ol>
<h2 id="dependencies">Dependencies</h2>
<h3 id="external-dependencies">External Dependencies</h3>
<ul>
<li><strong>gum</strong>: Charm Bracelet TUI framework (installed via apt/snap)</li>
<li><strong>uv</strong>: Astral Python package manager (installed from official source)</li>
<li><strong>fnm</strong>: Fast Node Manager (installed from official source)</li>
<li><strong>Zig 0.14.0+</strong>: For Ghostty compilation from source</li>
<li><strong>Node.js v25.2.0+</strong>: For AI tools and Astro documentation site</li>
<li><strong>GitHub CLI</strong>: For MCP integration and repository operations</li>
<li><strong>jq/yq</strong>: For JSON/YAML processing in scripts</li>
<li><strong>bc</strong>: For duration calculations</li>
</ul>
<h3 id="internal-dependencies">Internal Dependencies</h3>
<ul>
<li><strong>Constitutional Compliance</strong>: Adheres to .specify/memory/constitution.md v1.0.0 (10 core principles)</li>
<li><strong>Branch Strategy</strong>: Uses constitutional branch workflow (YYYYMMDD-HHMMSS-type-description)</li>
<li><strong>Local CI/CD</strong>: Integrates with .runners-local/workflows/gh-workflow-local.sh</li>
<li><strong>Documentation</strong>: Updates SPEC-KIT-TUI-INTEGRATION.md and related guides</li>
<li><strong>Logging Infrastructure</strong>: Uses existing /tmp/ghostty-start-logs/ and .runners-local/logs/</li>
</ul>
<h3 id="integration-points">Integration Points</h3>
<ul>
<li><strong>start.sh</strong>: Main installation script refactored to use new lib/ architecture</li>
<li><strong>Context7 MCP</strong>: Queries for best practices via mcp__context7__* tools</li>
<li><strong>GitHub MCP</strong>: Repository operations via mcp__github__* tools</li>
<li><strong>Performance Monitoring</strong>: Integrates with .runners-local/workflows/performance-monitor.sh</li>
<li><strong>App Audit</strong>: New module for duplicate detection (creates /tmp/ubuntu-apps-audit.md)</li>
</ul>
<h2 id="non-functional-requirements">Non-Functional Requirements</h2>
<h3 id="reliability">Reliability</h3>
<ul>
<li><strong>NFR-001</strong>: Installation success rate ≥99% across supported configurations</li>
<li><strong>NFR-002</strong>: Verification accuracy ≥99% (no false positives/negatives)</li>
<li><strong>NFR-003</strong>: Zero data loss during installation or updates (backup/restore capability)</li>
<li><strong>NFR-004</strong>: Graceful degradation when optional components unavailable (e.g., gum)</li>
</ul>
<h3 id="performance">Performance</h3>
<ul>
<li><strong>NFR-005</strong>: Total installation time &#x3C;10 minutes on fresh system (constitutional requirement)</li>
<li><strong>NFR-006</strong>: fnm startup time performance measured and logged (constitutional requirement)</li>
<li><strong>NFR-007</strong>: gum startup time performance measured and logged (verified during installation)</li>
<li><strong>NFR-008</strong>: Progress updates every ≤5 seconds during long-running tasks</li>
<li><strong>NFR-009</strong>: Log file size &#x3C;10MB per installation run (with rotation)</li>
</ul>
<h3 id="usability">Usability</h3>
<ul>
<li><strong>NFR-010</strong>: Professional visual appearance (no broken characters, clean formatting)</li>
<li><strong>NFR-011</strong>: Clear error messages with actionable recovery steps</li>
<li><strong>NFR-012</strong>: Installation resumable after interruption without user intervention</li>
<li><strong>NFR-013</strong>: User customizations preserved during updates (no manual reconfiguration)</li>
<li><strong>NFR-014</strong>: Verbose mode toggle for debugging (press ‘v’ or —verbose flag)</li>
</ul>
<h3 id="maintainability">Maintainability</h3>
<ul>
<li><strong>NFR-015</strong>: Modular architecture with single responsibility per lib/ module</li>
<li><strong>NFR-016</strong>: Each component independently testable (unit tests pass in isolation)</li>
<li><strong>NFR-017</strong>: Comprehensive logging for debugging (JSON + human-readable)</li>
<li><strong>NFR-018</strong>: Code coverage ≥80% for lib/core/, lib/ui/, lib/verification/ modules</li>
<li><strong>NFR-019</strong>: Documentation updated for all new lib/ modules and functions</li>
</ul>
<h3 id="security">Security</h3>
<ul>
<li><strong>NFR-020</strong>: No credentials or API keys logged or displayed</li>
<li><strong>NFR-021</strong>: Package downloads verified via checksums (where available)</li>
<li><strong>NFR-022</strong>: Sudo usage minimized and scoped (only where necessary)</li>
<li><strong>NFR-023</strong>: User data backups encrypted (if containing sensitive information)</li>
</ul>
<h3 id="compatibility">Compatibility</h3>
<ul>
<li><strong>NFR-024</strong>: Works on Ubuntu 25.10 (Questing) fresh installation</li>
<li><strong>NFR-025</strong>: Works on Ubuntu 25.10 with existing Ghostty installation (idempotency)</li>
<li><strong>NFR-026</strong>: Works via SSH (ASCII fallback for box drawing)</li>
<li><strong>NFR-027</strong>: Works in TTY console (ASCII fallback)</li>
<li><strong>NFR-028</strong>: Works with ZSH, Bash, or other POSIX shells (detection and adaptation)</li>
</ul>
<h2 id="implementation-notes">Implementation Notes</h2>
<h3 id="constitutional-compliance-checkpoints">Constitutional Compliance Checkpoints</h3>
<ol>
<li><strong>TUI Framework</strong>: Verify gum used exclusively (FR-001), no whiptail/dialog/rich-cli</li>
<li><strong>Box Drawing</strong>: Verify adaptive UTF-8/ASCII (FR-002-005), no hard-coded characters</li>
<li><strong>Verification</strong>: Verify real tests only (FR-007-012), no hard-coded success</li>
<li><strong>Package Managers</strong>: Verify uv exclusive (FR-032-033), fnm exclusive (FR-034-035)</li>
<li><strong>Architecture</strong>: Verify modular lib/ structure (FR-020-031), no monolithic start.sh</li>
<li><strong>Critical Files</strong>: Verify docs/.nojekyll preserved (not in this spec but related infrastructure)</li>
<li><strong>Directory Naming</strong>: Verify .runners-local/ used (not .runners-local/)</li>
<li><strong>Component Library</strong>: Verify DaisyUI used in website (not shadcn/ui)</li>
<li><strong>Node.js Version</strong>: Verify latest v25.2.0+ (not LTS/18+)</li>
</ol>
<h3 id="reconciliation-matrix-application">Reconciliation Matrix Application</h3>
<p>After spec generation, apply these corrections:</p>
<ul>
<li>✅ <code>.runners-local/</code> → <code>.runners-local/</code> (already correct in this spec)</li>
<li>✅ <code>shadcn/ui</code> → <code>DaisyUI</code> (not applicable to this spec)</li>
<li>✅ <code>Node.js 18+</code> → <code>Node.js latest (v25.2.0+)</code> (FR-038 compliant)</li>
<li>✅ Verify <code>gum</code> mentioned (FR-001 compliant)</li>
<li>✅ Verify <code>uv</code> for Python (FR-032 compliant)</li>
<li>✅ Verify <code>fnm</code> for Node.js (FR-034 compliant)</li>
<li>✅ Verify modular lib/ architecture (FR-020-031 compliant)</li>
</ul>
<h3 id="reference-documents">Reference Documents</h3>
<p>All implementation details available in /tmp/:</p>
<ul>
<li><code>TUI-SYSTEM-IMPLEMENTATION-PLAN.md</code> - Master plan (43 KB)</li>
<li><code>tui-framework-analysis.md</code> - gum framework details (19 KB)</li>
<li><code>collapsible-output-design.md</code> - Docker-like design (25 KB)</li>
<li><code>box-drawing-solution.md</code> - Adaptive solution (23 KB)</li>
<li><code>verification-framework-design.md</code> - Real test design (31 KB)</li>
<li><code>package-manager-integration.md</code> - uv &#x26; fnm integration (23 KB)</li>
<li><code>installation-script-architecture.md</code> - Modular design (24 KB)</li>
</ul>
<p>Proof-of-concept: <code>demo-tui-static.sh</code> validates adaptive box drawing and real verification approach.</p>
<p>App audit findings: <code>/tmp/ubuntu-apps-audit.md</code> (28 KB) - 4GB+ duplicate detection.</p>
<hr>
<p><strong>Next Steps</strong>:</p>
<ol>
<li>Create quality checklist at <code>specs/001-modern-tui-system/checklists/requirements.md</code></li>
<li>Validate specification against quality criteria</li>
<li>Apply reconciliation matrix (already applied above)</li>
<li>Commit with constitutional branch workflow</li>
<li>Proceed to <code>/speckit.plan</code> for implementation roadmap</li>
</ol> <div class="mt-12"> <div class="divider"></div> <div class="flex gap-2 flex-wrap"> <span class="badge badge-outline">developer</span><span class="badge badge-outline">technical</span> </div> </div> </article> </main> <!-- Modern Glass Footer --> <footer class="footer footer-center bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl text-gray-900 dark:text-gray-100 p-10 mt-16 border-t border-gray-200/50 dark:border-gray-700/50"> <aside> <p class="font-bold text-xl mb-2">
Ghostty Configuration Files
</p> <p class="max-w-2xl text-gray-600 dark:text-gray-400">
A comprehensive terminal environment setup featuring Ghostty terminal emulator<br>
with 2025 performance optimizations, AI tools integration, and intelligent update management.
</p> <p class="text-sm text-gray-600 dark:text-gray-400 mt-4">
Built with Astro v5 + Tailwind CSS v4 + DaisyUI v5
</p> </aside> </footer>  </body> </html>