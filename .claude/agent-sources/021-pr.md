---
name: 021-pr
description: Create a GitHub Pull Request using gh CLI. Takes title, body, base, head branches. Single atomic task - no decision making.
model: haiku
---

## Single Task
Create a Pull Request on GitHub using the `gh` CLI.

## Input
- title: PR title
- body: PR description/body
- base: Target branch (default: main)
- head: Source branch (default: current branch)
- draft: Create as draft PR (default: false)

## Execution
```bash
create_pull_request() {
  local title="$1"
  local body="$2"
  local base="${3:-main}"
  local head="${4:-$(git branch --show-current)}"
  local draft="${5:-false}"

  # Verify gh CLI is available
  if ! command -v gh &>/dev/null; then
    echo "status=error"
    echo "error=gh_not_installed"
    return 1
  fi

  # Verify authentication
  if ! gh auth status &>/dev/null; then
    echo "status=error"
    echo "error=gh_not_authenticated"
    return 1
  fi

  # Build command
  local cmd="gh pr create --title \"$title\" --base \"$base\" --head \"$head\""

  if [ "$draft" = "true" ]; then
    cmd="$cmd --draft"
  fi

  # Create PR with body via heredoc
  local output
  output=$(gh pr create \
    --title "$title" \
    --body "$body" \
    --base "$base" \
    --head "$head" \
    $([ "$draft" = "true" ] && echo "--draft") \
    2>&1)

  if [ $? -eq 0 ]; then
    # Extract PR URL from output
    local pr_url=$(echo "$output" | grep -o 'https://github.com/[^[:space:]]*')
    local pr_number=$(echo "$pr_url" | grep -o '[0-9]*$')

    echo "status=success"
    echo "pr_url=$pr_url"
    echo "pr_number=$pr_number"
    echo "title=$title"
    echo "base=$base"
    echo "head=$head"
    echo "draft=$draft"
  else
    echo "status=error"

    # Categorize error
    if echo "$output" | grep -q "already exists"; then
      echo "error=pr_exists"
      echo "hint=PR already exists for this branch"
    elif echo "$output" | grep -q "no commits"; then
      echo "error=no_commits"
      echo "hint=head branch has no commits ahead of base"
    else
      echo "error=create_failed"
      echo "output=$output"
    fi
  fi
}

# Create the PR
create_pull_request "$TITLE" "$BODY" "$BASE" "$HEAD" "$DRAFT"
```

## Output
Return ONLY:
```
status: success | error
pr_url: <full GitHub PR URL>
pr_number: <PR number>
title: <PR title>
base: <target branch>
head: <source branch>
draft: true | false
error: <error type if failed>
hint: <recovery hint if error>
```

## Examples
```
Input: title="feat: Add Haiku agents", body="...", base=main, head=20251128-feat-haiku
Output: status=success, pr_url=https://github.com/user/repo/pull/123, pr_number=123, title=feat: Add Haiku agents, base=main, head=20251128-feat-haiku

Input: title="...", base=main, head=main
Output: status=error, error=no_commits, hint=head branch has no commits ahead of base

Input: (PR already exists)
Output: status=error, error=pr_exists, hint=PR already exists for this branch
```

## Constraints
- Requires `gh` CLI installed and authenticated
- Does NOT merge PR (separate operation)
- Does NOT assign reviewers (parent can do via gh api)
- Returns PR URL for user reference
