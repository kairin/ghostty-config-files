---
name: 031-mcp
description: Test MCP server connectivity with timeout. Single atomic task.
model: haiku
---

## Single Task
Test if an MCP server is reachable and responding.

## Input
- server_name: MCP server identifier (e.g., context7, github)
- timeout_seconds: Connection timeout (default: 5)

## Known MCP Servers
- context7: Context7 documentation server
- github: GitHub MCP server

## Execution
```bash
test_mcp_connectivity() {
  local server="$1"
  local timeout="${2:-5}"

  if [ -z "$server" ]; then
    echo "status=error"
    echo "error=server_name_required"
    return 1
  fi

  # Check MCP configuration
  local mcp_config=".mcp.json"
  if [ ! -f "$mcp_config" ]; then
    mcp_config="$HOME/.config/claude-code/mcp.json"
  fi

  if [ ! -f "$mcp_config" ]; then
    echo "status=not_configured"
    echo "server=$server"
    echo "error=no_mcp_config_found"
    return 0
  fi

  # Check if server is in config
  if ! grep -q "\"$server\"" "$mcp_config" 2>/dev/null; then
    echo "status=not_configured"
    echo "server=$server"
    echo "error=server_not_in_config"
    echo "config_file=$mcp_config"
    return 0
  fi

  # Server-specific checks
  case "$server" in
    context7)
      # Check Context7 API key
      if [ -z "${CONTEXT7_API_KEY:-}" ]; then
        echo "status=not_authenticated"
        echo "server=context7"
        echo "error=CONTEXT7_API_KEY not set"
        return 0
      fi
      echo "status=configured"
      echo "server=context7"
      echo "api_key_present=true"
      ;;

    github)
      # Check GitHub token
      if ! gh auth status &>/dev/null; then
        echo "status=not_authenticated"
        echo "server=github"
        echo "error=gh not authenticated"
        return 0
      fi
      echo "status=configured"
      echo "server=github"
      echo "gh_authenticated=true"
      ;;

    *)
      # Generic check - just verify config entry
      echo "status=configured"
      echo "server=$server"
      echo "note=generic check only"
      ;;
  esac

  echo "config_file=$mcp_config"
}

# Test connectivity
test_mcp_connectivity "$SERVER_NAME" "$TIMEOUT_SECONDS"
```

## Output
Return ONLY:
```
status: configured | not_configured | not_authenticated | error
server: <server name>
config_file: <path to MCP config>
api_key_present: true | false (for context7)
gh_authenticated: true | false (for github)
error: <error message if applicable>
```

## Examples
```
Input: server_name=context7
Output: status=configured, server=context7, api_key_present=true

Input: server_name=github (not authenticated)
Output: status=not_authenticated, server=github, error=gh not authenticated

Input: server_name=unknown
Output: status=not_configured, server=unknown, error=server_not_in_config
```

## Constraints
- Does not make external network calls
- Validates configuration presence
- Checks authentication prerequisites
