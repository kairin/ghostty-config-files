---
name: 031-env
description: Check if environment variable is exported to shell. Single atomic task.
model: haiku
---

## Single Task
Check if an environment variable is defined and exported.

## Input
- var_name: Name of environment variable to check
- check_value: Check if non-empty (default: true)

## Execution
```bash
check_env_var() {
  local var="$1"
  local check_value="${2:-true}"

  if [ -z "$var" ]; then
    echo "status=error"
    echo "error=var_name_required"
    return 1
  fi

  # Check if variable is set
  eval "local value=\${$var:-}"

  if [ -z "$value" ]; then
    # Not set or empty
    echo "status=not_set"
    echo "variable=$var"
    echo "exported=false"
    echo "has_value=false"

    # Check if it's in a .env file
    if [ -f ".env" ] && grep -q "^$var=" .env; then
      echo "in_env_file=true"
      echo "hint=source .env or export manually"
    else
      echo "in_env_file=false"
    fi
  else
    # Variable is set
    echo "status=set"
    echo "variable=$var"
    echo "exported=true"
    echo "has_value=true"

    # Report value length (not the value itself for security)
    echo "value_length=${#value}"

    # Check if it looks like a placeholder
    if echo "$value" | grep -qiE '^(your_|xxx|placeholder|changeme|todo)'; then
      echo "is_placeholder=true"
    else
      echo "is_placeholder=false"
    fi
  fi
}

# Check variable
check_env_var "$VAR_NAME" "$CHECK_VALUE"
```

## Output
Return ONLY:
```
status: set | not_set | error
variable: <variable name>
exported: true | false
has_value: true | false
value_length: <length without exposing value>
is_placeholder: true | false
in_env_file: true | false
hint: <suggestion if not set>
```

## Examples
```
Input: var_name=GITHUB_TOKEN
Output: status=set, variable=GITHUB_TOKEN, exported=true, has_value=true, value_length=40

Input: var_name=MISSING_VAR
Output: status=not_set, variable=MISSING_VAR, exported=false, in_env_file=false

Input: var_name=CONTEXT7_API_KEY (placeholder value)
Output: status=set, exported=true, is_placeholder=true
```

## Security
- Does NOT expose the actual value
- Reports length and placeholder status only

## Constraints
- Read-only check
- Does not set or modify variables
- Security-conscious output
