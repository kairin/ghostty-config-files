---
name: 031-dir
description: Verify directory exists and is writable. Single atomic task.
model: haiku
---

## Single Task
Check that a directory exists and has write permissions.

## Input
- dir_path: Path to directory to check
- create_if_missing: Create directory if missing (default: false)

## Execution
```bash
verify_directory() {
  local dir="$1"
  local create="${2:-false}"

  if [ -z "$dir" ]; then
    echo "status=error"
    echo "error=path_required"
    return 1
  fi

  # Check if exists
  if [ ! -e "$dir" ]; then
    if [ "$create" = "true" ]; then
      mkdir -p "$dir" 2>/dev/null
      if [ -d "$dir" ]; then
        echo "status=created"
        echo "path=$dir"
        echo "existed=false"
        echo "writable=true"
        return 0
      else
        echo "status=error"
        echo "path=$dir"
        echo "error=create_failed"
        return 1
      fi
    else
      echo "status=missing"
      echo "path=$dir"
      echo "existed=false"
      return 0
    fi
  fi

  # Check if it's a directory
  if [ ! -d "$dir" ]; then
    echo "status=error"
    echo "path=$dir"
    echo "error=not_a_directory"
    return 1
  fi

  # Check write permission
  if [ -w "$dir" ]; then
    echo "status=ok"
    echo "path=$dir"
    echo "existed=true"
    echo "writable=true"
  else
    echo "status=read_only"
    echo "path=$dir"
    echo "existed=true"
    echo "writable=false"
  fi

  # Additional info
  local file_count=$(find "$dir" -maxdepth 1 -type f 2>/dev/null | wc -l)
  local dir_count=$(find "$dir" -maxdepth 1 -type d 2>/dev/null | wc -l)
  echo "file_count=$file_count"
  echo "subdir_count=$((dir_count - 1))"
}

# Verify directory
verify_directory "$DIR_PATH" "$CREATE_IF_MISSING"
```

## Output
Return ONLY:
```
status: ok | missing | read_only | created | error
path: <directory path>
existed: true | false
writable: true | false
file_count: <files in directory>
subdir_count: <subdirectories>
error: <error message if applicable>
```

## Examples
```
Input: dir_path=.runners-local/logs
Output: status=ok, path=.runners-local/logs, existed=true, writable=true, file_count=5

Input: dir_path=new/directory, create_if_missing=true
Output: status=created, path=new/directory, existed=false, writable=true

Input: dir_path=/root/protected
Output: status=read_only, path=/root/protected, existed=true, writable=false
```

## Constraints
- Only creates directory if explicitly requested
- Reports permissions accurately
- Does not modify existing directories
